#:import dp kivy.metrics.dp
#:set primary_color [0.2, 0.6, 0.8, 1]
#:set success_color [0.2, 0.8, 0.4, 1]
#:set warning_color [0.9, 0.6, 0.2, 1]
#:set danger_color [0.8, 0.2, 0.2, 1]

<ImageButton>:
    size_hint: None, None
    size: dp(40), dp(40)
    source: ''

<TaskItem>:
    size_hint_y: None
    height: dp(90)
    padding: dp(10)
    spacing: dp(10)
    canvas.before:
        Color:
            rgba: [0.95, 0.95, 0.95, 1] if root.status == "completed" else [1, 1, 1, 1]
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: success_color if root.status == "completed" else warning_color if root.status == "in_progress" else primary_color
        Line:
            width: dp(1.5)
            rectangle: self.x, self.y, self.width, self.height

    Label:
        text: "[â€¢]" if root.status == "completed" else "[>]" if root.status == "in_progress" else "[ ]"
        font_size: dp(24)
        size_hint_x: 0.1
        markup: True

    BoxLayout:
        orientation: 'vertical'
        size_hint_x: 0.6
        spacing: dp(5)
        padding: dp(5)

        Label:
            text: root.title
            font_size: dp(16)
            bold: True
            halign: 'left'
            text_size: self.width, None
            size_hint_y: 0.6

        Label:
            text: f"[size=12]Due: {root.due_date}[/size]"
            markup: True
            halign: 'left'
            text_size: self.width, None
            size_hint_y: 0.4
            color: danger_color if root.status == "pending" and root.is_overdue() else [0.4, 0.4, 0.4, 1]

    BoxLayout:
        orientation: 'horizontal'
        size_hint_x: 0.3
        spacing: dp(5)

        Button:
            text: "Start" if root.status != "in_progress" else "Pause"
            size_hint_x: 0.5
            background_color: warning_color if root.status != "in_progress" else primary_color
            on_release: root.update_status("in_progress" if root.status != "in_progress" else "pending")

        Button:
            text: "Complete" if root.status != "completed" else "Undo"
            size_hint_x: 0.5
            background_color: success_color if root.status != "completed" else primary_color
            on_release: root.update_status("completed" if root.status != "completed" else "pending")

        Button:
            text: "X"
            size_hint_x: 0.3
            background_color: danger_color
            on_release: root.delete_task()

<HomeScreen>:
    task_list: task_list
    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        spacing: dp(10)

        BoxLayout:
            size_hint_y: None
            height: dp(60)
            spacing: dp(10)

            Label:
                text: 'My Tasks'
                font_size: dp(24)
                bold: True
                size_hint_x: 0.7

            Button:
                text: 'Add Task'
                size_hint_x: 0.3
                background_color: primary_color
                on_release: root.manager.current = 'add'

        ScrollView:
            GridLayout:
                id: task_list
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(10)

<AddTaskScreen>:
    title_input: title_input
    desc_input: desc_input
    date_input: date_input

    BoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(15)

        Label:
            text: 'Add New Task'
            font_size: dp(24)
            bold: True
            size_hint_y: None
            height: dp(40)

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(50)
            spacing: dp(10)

            Label:
                text: 'Title:'
                size_hint_x: 0.2
                halign: 'right'

            TextInput:
                id: title_input
                hint_text: 'Enter task title'
                size_hint_x: 0.8

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(100)
            spacing: dp(10)

            Label:
                text: 'Description:'
                size_hint_x: 0.2
                halign: 'right'

            TextInput:
                id: desc_input
                hint_text: 'Enter task description'
                size_hint_x: 0.8
                multiline: True

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(50)
            spacing: dp(10)

            Label:
                text: 'Due Date:'
                size_hint_x: 0.2
                halign: 'right'

            TextInput:
                id: date_input
                hint_text: 'YYYY-MM-DD'
                size_hint_x: 0.8

        BoxLayout:
            size_hint_y: None
            height: dp(50)
            spacing: dp(10)

            Button:
                text: 'Cancel'
                background_color: danger_color
                on_release: 
                    root.manager.current = 'home'
                    root.reset_form()

            Button:
                text: 'Save Task'
                background_color: success_color
                on_release: root.add_task()